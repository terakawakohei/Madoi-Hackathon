<!-- <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      canvas {
        margin-top: 1rem;
        border: solid 1px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="360px" height="360px"></canvas>
    <script src="https://fungo.kcg.edu/madoi-20211030/js/madoi.js"></script>
    <script>
      class WhiteBoard {
        constructor() {
          this.canvas = document.querySelector("#canvas");
          this.ctx = this.canvas.getContext("2d");

          let prev;
          this.canvas.addEventListener("mousedown", (e) => {
            prev = { x: e.offsetX, y: e.offsetY };
          });
          this.canvas.addEventListener("mouseup", () => {
            prev = null;
          });
          this.canvas.addEventListener("mousemove", (e) => {
            if (!prev) return;
            this.draw(prev.x, prev.y, e.offsetX, e.offsetY);
            prev = { x: e.offsetX, y: e.offsetY };
          });
        }

        draw(prevX, prevY, x, y) {
          this.ctx.beginPath();
          this.ctx.moveTo(prevX, prevY);
          this.ctx.lineTo(x, y);
          this.ctx.stroke();
        }

        getState() {
          return this.canvas.toDataURL("image/png");
        }

        setState(state) {
          const img = new Image();
          img.onload = () => {
            this.ctx.drawImage(img, 0, 0);
          };
          img.src = state;
        }
      }

      window.addEventListener("load", () => {
        const m = new madoi.Madoi("rooms/whiteboard-asdfasdfqr33");
        const wb = new WhiteBoard();
        m.register(wb, [
          { method: wb.draw, share: { type: "afterExec", maxLog: 100 } },
          {
            method: wb.getState,
            getState: { maxInterval: 3000, maxUpdates: 100 },
          },
          { method: wb.setState, setState: {} },
        ]);
      });
    </script>
  </body>
</html> -->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8" />
    <style>
      #chatLog {
        border: 1px solid;
        width: 100%;
        height: 300px;
        overflow: scroll;
      }
    </style>
  </head>
  <body>
    <form id="chatForm">
      <input id="name" size="8" type="text" value="匿名" />
      <input
        id="message"
        size="20"
        type="text"
        placeholder="送信するメッセージ"
      />
      <button type="submit">送信</button>
    </form>
    <div id="chatLog"></div>
    <script src="https://fungo.kcg.edu/madoi-20211030/js/madoi.js"></script>
    <script>
      window.addEventListener("load", () => {
        const chatForm = document.querySelector("#chatForm");
        const nameInput = document.querySelector("#name");
        const messageInput = document.querySelector("#message");
        const logDiv = document.querySelector("#chatLog");

        addMessage = function (name, message) {
          const span = document.createElement("span");
          const br = document.createElement("br");
          span.append(name + ": " + message);
          logDiv.append(span);
          logDiv.append(br);
          logDiv.scrollTop = logDiv.scrollHeight;
        };

        chatForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const name = nameInput.value.trim();
          const message = messageInput.value.trim();
          if (message.length == 0) return false;
          messageInput.value = "";
          addMessage(name, message);

          const m = new madoi.Madoi("rooms/kelajn3ia");
          const originalAddMessage = addMesasge;
          対比;
          置き換える;
          対比していたものを呼び戻す;

          m.setHandler("addMessage", (body) => {
            addMessage(body.name, body.message);
          });
        });
      });
    </script>
  </body>
</html>
